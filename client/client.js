Meteor.startup(function() {
  $(window).resize(function() {
    $('#map').css('height', window.innerHeight - 82 - 45);
  });
  $(window).resize(); // trigger resize event 
});

Template.map.helpers({
  controllerList : function(){
    Meteor.subscribe()
  },
  pilotList : function(){

  }
});

//!!!! Positions are not yet tied to live data, with ifs or whatnot !!!!!
Template.map.rendered = function() {
  //Not sure what it does, but didn't work without this.
  L.Icon.Default.imagePath = 'packages/bevanhunt_leaflet/images';

//The outline of each tracon and the airspace.
var ZBWARTCCCoordinates = [[44.1041665979719, -76.4166667266982], [43.6333332529291, -76.79166670487029], [43.0666667170357, -76.76388881788201], [42.8833332965849, -76.6666666534729], [42.7277777631224, -76.6972221355381], [42.6083332539187, -76.8027777892576], [42.2833333315095, -76.0166666326346], [41.98888889116551, -75.3416666719248], [41.8694443819618, -75.0583333159681], [41.80138890207941, -74.9083333246992], [41.7583333620685, -74.80833338919329], [41.7333332461771, -74.76666664672091], [41.43750000829461, -74.4444444954085], [41.2458332745533, -73.8666666991077], [40.8583334144554, -73.8597221833557], [40.8583334144554, -73.3777777539256], [40.8013888429404, -73.2916666739038], [40.2388888756822, -73.69861110769951], [39.9333333509508, -73.7291665897646], [39.7333333039191, -73.2833333606133], [39.7333333039191, -73.1499999959255], [39.9944444911011, -73.00833331794711], [40.1986111067682, -72.7819443574854], [40.0722222578324, -72.49999997508711], [40.5766666155448, -70.8794445151642], [40.9249999207794, -69.3416666691308], [40.9999999164138, -68.9999999441206], [41.6166666840901, -67.0000000018626], [41.8666666108649, -67.0000000018626], [44.9333332946058, -67.0000000018626], [45.6250000579166, -67.7750000740984], [45.783333362476, -67.80694435370189], [45.8249999289284, -67.5833333403571], [46.1430555116055, -67.21666667547539], [46.2000000831205, -67.21666667547539], [46.53611108991711, -67.2999999844003], [46.5725000497035, -67.2491666501143], [46.6119443640745, -67.2033333390066], [46.6452777932565, -67.1702778453523], [46.6983333796239, -67.1275000648492], [46.74444445023931, -67.09777786130709], [46.7922222539208, -67.074166718974], [46.8413888551407, -67.05666663785], [46.8913889109037, -67.04555555346271], [46.9416667261743, -67.04055553028439], [46.9922223009526, -67.0422222633505], [47.04249994020331, -67.05027781713331], [47.0919444769508, -67.0980556208147], [47.1405555591554, -67.08527780336129], [47.1875000843138, -67.1122222358066], [47.2327777003862, -67.1449999699532], [47.27583341641701, -67.18361118182111], [47.3166667043464, -67.2277777598628], [47.3544444616713, -67.2769443610827], [47.38944444789941, -67.33055564248551], [47.4208333845076, -67.3888888355189], [47.4486110954759, -67.4508332541923], [47.4727777568243, -67.5163888985054], [47.4927778495375, -67.5847221378955], [47.5086111975954, -67.65555556489471], [47.52027780099811, -67.72805554893991], [47.5275000762579, -67.80194450654361], [47.5302778473547, -67.8763888071427], [47.52861111428861, -67.9508332837618], [47.5227778125872, -68.02500000087312], [47.5122222472153, -68.0977777444261], [47.49749993718811, -68.1691666904406], [47.478333299018, -68.23833338437370], [47.4552778517203, -68.30444437168229], [47.428333243255, -68.367500004406310], [47.3977777611899, -68.42666665198280], [47.3638888129926, -68.48194449043170], [47.326666750703, -68.532222305702400], [47.2875000198197, -68.56666659689510], [47.4500000690343, -69.21666661773340], [46.749999992433, -70.000000003259600], [46.4166667567333, -70.05833337231310], [46.30833333191691, -70.2083333635819], [45.9083334138733, -70.24999993003441], [45.6861110220469, -70.50277780392599], [45.31666658606851, -71.0000000623986], [45.2833333329065, -71.33611106919510], [45.0166666035308, -71.48333328936720], [44.9999999769498, -74.24999999057042], [45.18333339740061, -74.5666665996891], [45.14305562848651, -74.7844444873525], [45.0691666708829, -74.96666669375260], [44.9666667237878, -74.88333338482769], [44.8166667325189, -75.75000007927881], [44.6666667412501, -75.70000002351590], [44.716666620993, -75.499999976484120], [44.512500005326, -75.766666705859810], [44.4458333229821, -75.81666658560280], [44.34722218501461, -75.9499999502907], [44.34999995611140, -76.00000000605360], [44.32222224514310, -76.06666668839750], [44.29166658705800, -76.133333370741510], [44.23333339402450, -76.18333325048440], [44.20416670949780, -76.23333330624740], [44.20416670949780, -76.28333336201030], [44.16666671168060, -76.33333341777320], [44.10416659797190, -76.41666672669820] ]; var A90Coordinates = [[42.5500000000000, -71.8750000000000], [42.4500000000000, -71.8333333333333], [42.3750000000000, -71.8194444444444], [42.0618000000000, -71.6454500000000], [42.1000000000000, -71.4833333333333], [42.0155555555556, -71.3608333333333], [41.8283333333333, -71.3916666666667], [41.7761111111111, -71.0972222222222], [41.6958333333333, -71.1625000000000], [41.7708333333333, -70.6666666666667], [42.1000000000000, -70.3166666666667], [42.2388888888889, -70.3166666666667], [42.5388888888889, -70.3083333333333], [42.6166666666667, -70.5166666666667], [42.7208333333333, -70.4166666666667], [42.8125000000000, -70.4166666666667], [43.0333333333333, -70.2833333333333], [43.2916666666667, -70.6500000000000], [43.4166666666667, -70.9916666666667], [43.7166666666667, -71.1833333333333], [43.7583333333333, -71.3833333333333], [43.7083333333333, -71.9000000000000], [43.4333333333333, -71.9375000000000], [43.1333333333333, -71.9833333333333], [43.0750000000000, -71.9666666666667], [42.9375000000000, -71.9083333333333], [42.8666666666667, -71.8833333333333], [42.7333333333333, -71.8916666666667], [42.6166666666667, -71.9000000000000], [42.5500000000000, -71.8750000000000] ]; var ALBCoordinates = [[43.2666666666667, -74.4000000000000], [43.3263888888889, -74.0352777777778], [43.3711111111111, -73.8222222222222], [43.5361111111111, -73.7500000000000], [43.5250000000000, -73.4875000000000], [43.3666666666667, -73.4250000000000], [43.3377777777778, -73.4191666666667], [43.2666666666667, -73.2405555555556], [43.2113888888889, -73.1058333333333], [43.1083333333333, -72.8583333333333], [43.0222222222222, -73.0166666666667], [42.6333333333333, -73.0008333333333], [42.5972222222222, -72.8527777777778], [42.5416666666667, -72.7333333333333], [42.4444444444444, -72.8444444444444], [42.3713888888889, -72.9750000000000], [42.0527777777778, -73.3777777777778], [41.9750000000000, -73.4666666666667], [41.9883333333333, -74.0455555555556], [42.1416666666667, -74.0000000000000], [42.1750000000000, -74.3000000000000], [42.3611111111111, -74.4458333333333], [42.5416666666667, -74.5833333333333], [42.6750000000000, -74.5625000000000], [43.0000000000000, -74.5166666666667], [43.2666666666667, -74.4000000000000] ];
var BGRCoordinates = [[44.4166666666667, -67.9916666666667], [44.2833333333333, -68.0000000000000], [44.2250000000000, -68.1500000000000], [44.1000000000000, -68.8166666666667], [44.1833333333333, -69.0000000000000], [44.2638888888889, -69.4000000000000], [44.2638888888889, -69.4000000000000], [44.6166666666667, -69.5166666666667], [44.5000000000000, -69.7166666666667], [44.8480555555556, -69.6788888888889], [45.1333333333333, -69.3666666666667], [45.2375000000000, -69.0000000000000], [45.2833333333333, -68.6333333333333], [45.2833333333333, -68.6333333333333], [45.1916666666667, -68.3583333333333], [44.7716666666667, -68.1447222222222], [44.4166666666667, -67.9916666666667] ]; 
var Y90Coordinates = [[42.0527777777778, -73.3777777777778], [42.3713888888889, -72.9750000000000], [42.4444444444444, -72.8444444444444], [42.5416666666667, -72.7333333333333], [42.5372222222222, -72.6886111111111], [42.5000000000000, -72.3250000000000], [42.4166666666667, -72.2861111111111], [42.4055555555556, -72.0027777777778], [42.4500000000000, -71.8333333333333], [42.3750000000000, -71.8194444444444], [42.0618000000000, -71.6454500000000], [41.9958333333333, -71.9250000000000], [41.8027777777778, -72.0625000000000], [41.6069444444444, -72.1541666666667], [41.4833333333333, -72.4666666666667], [41.2750000000000, -72.5500000000000], [41.2844444444444, -72.7416666666667], [41.3308333333333, -72.8011111111111], [41.3691666666667, -73.0000000000000], [41.4736111111111, -73.2000000000000], [41.5875000000000, -73.2138888888889], [41.7652777777778, -73.2500000000000], [42.0527777777778, -73.3777777777778] ];
var BTVCoordinates = [[44.9944444444444, -72.4222222222222], [44.5486111111111, -72.7277777777778], [44.0888888888889, -72.7569444444444], [43.8833333333333, -73.2833333333333], [43.8833333333333, -73.4333333333333], [43.8833333333333, -73.5500000000000], [44.0000000000000, -73.8750000000000], [44.7416666666667, -73.8833333333333], [44.7750000000000, -74.0166666666667], [45.0000000000000, -73.9750000000000], [45.0000000000000, -73.2500000000000], [44.9944444444444, -72.4222222222222] ];
var K90Coordinates = [[42.2833333333333, -69.8250000000000], [42.0833333333333, -69.5000000000000], [41.7750000000000, -69.5000000000000], [41.1666666666667, -69.5000000000000], [41.0833333333333, -69.6161111111111], [40.8988888888889, -69.7669444444444], [41.0000000000000, -69.9322222222222], [41.0416666666667, -70.0000000000000], [41.0438888888889, -70.0041666666667], [41.0427777777778, -70.0238888888889], [41.0413888888889, -70.0866666666667], [41.0422222222222, -70.1566666666667], [41.0558333333333, -70.2169444444445], [41.0619444444444, -70.2361111111111], [41.0763888888889, -70.2666666666667], [41.0905555555556, -70.3297222222222], [41.1144444444444, -70.3808333333333], [41.0580555555556, -70.6327777777778], [40.9638888888889, -71.0294444444444], [41.4372222222222, -71.0305555555556], [41.5638888888889, -70.8333333333333], [41.7027777777778, -70.7875000000000], [41.7604000000000, -70.7357000000000], [41.7708333333333, -70.6666666666667], [42.1000000000000, -70.3166666666667], [42.1000000000000, -70.3166666666667], [42.2388888888889, -70.3166666666667], [42.3111111111111, -70.3147000000000], [42.2833333333333, -69.8250000000000] ];
var PWMCoordinates = [[44.1666666666667, -70.8166666666667], [44.3333333333333, -70.8661111111111], [44.3333333333333, -70.8661111111111], [44.5833333333333, -70.9666666666667], [44.3333333333333, -70.3661111111111], [44.5472222222222, -70.2161111111111], [44.8066666666667, -70.1033333333333], [44.8480555555556, -69.6788888888889], [44.5000000000000, -69.7166666666667], [44.6166666666667, -69.5166666666667], [44.2638888888889, -69.4000000000000], [44.1833333333333, -69.0000000000000], [44.1000000000000, -68.8166666666667], [43.8666666666667, -68.8000000000000], [43.6833333333333, -69.5000000000000], [43.3166666666667, -69.5000000000000], [43.3166666666667, -69.9333333333333], [43.2000000000000, -70.1500000000000], [43.0333333333333, -70.2833333333333], [43.2916666666667, -70.6500000000000], [43.4166666666667, -70.9916666666667], [43.7166666666667, -71.1833333333333], [43.7833333333333, -71.1583333333333], [44.1666666666667, -70.8166666666667] ];
var PVDCoordinates = [[41.7027777777778, -70.7875000000000], [41.5638888888889, -70.8333333333333], [41.4372222222222, -71.0305555555556], [40.9638888888889, -71.0294444444444], [40.7647222222222, -71.8527777777778], [41.0650000000000, -72.1741666666667], [41.1250000000000, -72.2500000000000], [41.3625000000000, -72.3833333333333], [41.4833333333333, -72.4666666666667], [41.6069444444444, -72.1541666666667], [41.8027777777778, -72.0625000000000], [41.9958333333333, -71.9250000000000], [42.1000000000000, -71.4833333333333], [42.0155555555556, -71.3608333333333], [41.8283333333333, -71.3916666666667], [41.7761111111111, -71.0972222222222], [41.6958333333333, -71.1625000000000], [41.7604000000000, -70.7357000000000], [41.7027777777778, -70.7875000000000], ];
var SYRCoordinates = [[43.6333333333333, -76.7913888888889], [43.6333333333333, -76.3000000000000], [43.6750000000000, -75.9000000000000], [43.6722222222222, -75.3180555555555], [43.6652777777778, -74.7805555555556], [43.2666666666667, -74.4000000000000], [43.0000000000000, -74.5166666666667], [42.6750000000000, -74.5625000000000], [42.6666666666667, -74.6166666666667], [42.6666666666667, -74.9500000000000], [42.7000000000000, -75.3333333333333], [42.7000000000000, -75.5833333333333], [42.5000000000000, -75.7333333333333], [42.5500000000000, -76.1861111111111], [42.7919444444444, -76.6847222222222], [42.8791666666667, -76.6750000000000], [43.0666666666667, -76.7638888888889], [43.6333333333333, -76.7913888888889] ];

  //Gives a beautiful map with live weather. I think this zoom works best.
  var map = L.map('map', {
    doubleClickZoom: true
  }).setView([42.3629650, -71.0064238], 6);
  L.tileLayer.provider('OpenStreetMap.Mapnik').addTo(map);
  L.tileLayer.provider('OpenWeatherMap.Precipitation').addTo(map);

  //Execute each of these commands if the center or the tracon covering it is online
  var zbw = L.polygon(ZBWARTCCCoordinates, {smoothFactor: .5, color: '#10ef49', opacity: .5}).addTo(map);
  var alb = L.polygon(ALBCoordinates, {smoothFactor: .5, color: '#42669a', opacity: .6 }).addTo(map);
  var bgr = L.polygon(BGRCoordinates, {smoothFactor: .5, color: '#42669a', opacity: .6 }).addTo(map);
  var y90 = L.polygon(Y90Coordinates, {smoothFactor: .5, color: '#42669a', opacity: .6 }).addTo(map);
  var btv = L.polygon(BTVCoordinates, {smoothFactor: .5, color: '#42669a', opacity: .6 }).addTo(map);
  var k90 = L.polygon(K90Coordinates, {smoothFactor: .5, color: '#42669a', opacity: .6 }).addTo(map);
  var pwm = L.polygon(PWMCoordinates, {smoothFactor: .5, color: '#42669a', opacity: .6 }).addTo(map);
  var pvd = L.polygon(PVDCoordinates, {smoothFactor: .5, color: '#42669a', opacity: .6 }).addTo(map);
  var syr = L.polygon(SYRCoordinates, {smoothFactor: .5, color: '#42669a', opacity: .6 }).addTo(map);
  var a90 = L.polygon(A90Coordinates, {smoothFactor: .5, color: '#42669a', opacity: .6 }).addTo(map);

  //D for Delivery, if DEL is online at the airport, eg BOS_DEL, this should show up at that airports lat/lon.
  var dIcon = L.icon({
    iconUrl: '/d.png',
    shadowUrl: '/d.png',
    iconSize: [10, 10],
    shadowSize: [0,0],
    iconAnchor: [-10, 0],
    shadowAnchor: [-10, 0],
    popupAnchor: [-10,0]
  });

  //G for Ground, see above.
  var gIcon = L.icon({
    iconUrl: '/g.png',
    shadowUrl: '/g.png',
    iconSize: [10, 10],
    shadowSize: [0,0],
    iconAnchor: [0, 0],
    shadowAnchor: [0, 0],
    popupAnchor: [0,0]
  });

  //T for tower, see above.
  var tIcon = L.icon({
    iconUrl: '/t.png',
    shadowUrl: '/t.png',
    iconSize: [10, 10],
    shadowSize: [0,0],
    iconAnchor: [10, 0],
    shadowAnchor: [0, 0],
    popupAnchor: [0,0]
  });
  //This makes 'em show up at Boston.
  //L.marker([42.3629650, -71.0064238], {icon: dIcon}).addTo(map);
  //L.marker([42.3629650, -71.0064238], {icon: gIcon}).addTo(map);
  //L.marker([42.3629650, -71.0064238], {icon: tIcon}).addTo(map);
}